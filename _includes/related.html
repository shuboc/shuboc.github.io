<div class="related-posts">
  <h2>相關文章</h2>

  {% assign maxRelated = 5 %}
  {% assign minCommonTags = 1 %}
  {% assign relatedCount = 0 %}

  <!-- Display posts that have the same tag as the current post-->
  {% for post in site.posts %}
    <!-- Calculate # of common tags -->
    {% assign sameTagCount = 0 %}
    {% for tag in post.tags %}
      {% if post.url != page.url %}
        {% if page.tags contains tag %}
          {% assign sameTagCount = sameTagCount | plus: 1 %}
          {% capture tagmarkup %} <span class="label label-default">{{ tag }}</span> {% endcapture %}
        {% endif %}
      {% endif %}
    {% endfor %}

    <!-- Display hyperlink -->
    {% if sameTagCount >= minCommonTags %}
      <p>
        <a href="{{ post.url }}" target="_blank">{{ post.title }}</a>
      </p>
      <!-- Check if # of max related posts has been reached -->
      {% assign relatedCount = relatedCount | plus: 1 %}
      {% if relatedCount >= maxRelated %}
        {% break %}
      {% endif %}
    {% endif %}
  {% endfor %}

  <!-- Recent posts (if the above is not enough) -->
  {% if relatedCount < maxRelated %}
    {% for post in site.related_posts %}
      <p>
        <a href="{{ post.url }}" target="_blank">{{ post.title }}</a>
      </p>
      <!-- Check if # max related posts has been reached -->
      {% assign relatedCount = relatedCount | plus: 1 %}
      {% if relatedCount >= maxRelated %}
        {% break %}
      {% endif %}
    {% endfor %}
  {% endif %}

</div>
